GLOBAL.V.MainWindowWidth="700",GLOBAL.V.MainWindowHeight="480",GLOBAL.P.check=Array(),$(window).resize(function(){GPW.layout.mainLayout.setSizes()});var GPC={url:{queryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/queryPage?"+GLOBAL.P.parameter,loadUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/load?"+GLOBAL.P.parameter,getMessageUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/message",detailQueryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/tpl/DetailQuery/News/d?"+GLOBAL.P.parameter,delectUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/delect",categoryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/category",operationUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/operation"},constant:{add:"add",edit:"edit",delect:"delect",query:"query",update:"update",detailQuery:"detailQuery",between:"between"}},GPW={layout:{},toolbar:{},grid:{},window:{},form:{},paging:{}};GPW.layout={mainLayout:{},mainGridLayout:{},init:function(){this.mainLayout=new dhtmlXLayoutObject("layoutObj","1C"),this.mainGridLayout=this.mainLayout.cells("a"),this.mainGridLayout.hideHeader()}},GPW.grid={mainGrid:{},init:function(){this.mainGrid=GPW.layout.mainGridLayout.attachGrid(),this.mainGrid.setImagePath(GLOBAL.IconsPath),this.mainGrid.setHeader(GLOBAL.P.P_GRID_HEADER),this.mainGrid.setColumnIds(GLOBAL.P.P_GRID_COLUMNIDS),this.mainGrid.setInitWidths(GLOBAL.P.P_GRID_WIDTH),this.mainGrid.setColAlign(GLOBAL.P.P_GRID_COLALIGN),this.mainGrid.setColTypes(GLOBAL.P.P_GRID_COLTYPES),this.mainGrid.setColSorting(GLOBAL.P.P_GRID_COLSORTING),this.mainGrid.setColValidators(GLOBAL.P.P_GRID_VALIDATORS),GLOBAL.initGridCombo(this.mainGrid,GLOBAL.P.P_GRID_FORMGRIDASSEMBLE),this.mainGrid.setDateFormat("%Y-%m-%d"),GLOBAL.S.SEC_U_V||this.mainGrid.setEditable(!1);var e="<div id='recinfoArea' /><div id='pagingArea' style='border:none;'/>",a=GPW.layout.mainGridLayout.attachStatusBar({height:28});a.setText(e),this.mainGrid.enablePaging(!0,20,5,"pagingArea",!0,"recInfoArea"),this.mainGrid.setPagingSkin("toolbar","dhx_skyblue"),this.mainGrid.i18n.paging=GLOBAL.paging,this.mainGrid.init(),this.mainGrid.attachEvent("onValidationError",function(e,a,t,i){parent.dhtmlx.message({type:"error",expire:-1,text:"校验错误："+GPW.grid.mainGrid.getColLabel(a)+","+GLOBAL.validText(i)+",字段值不能为["+t+"]！"})}),this.mainGrid.attachEvent("onXLE",function(e){SpinnerCtl.close(),e.forEachRow(function(e){var a="/show/static/cms/images/delect.ico",t="/show/static/cms/images/update_0e23cfa.gif";this.cells(e,this.getColIndexById("delect")).setValue(a),this.cells(e,this.getColIndexById("update")).setValue(t)})}),this.refreshMainGrid(),this.mainGrid.attachEvent("onRightClick",function(e,a){this.getColIndexById("subject")==a&&$.ajax({type:"GET",url:GPC.url.getMessageUrl+"/"+e,success:function(e){dhtmlx.message(e)}})}),this.mainGrid.attachEvent("onRowSelect",function(e,a){if(this.getColIndexById("delect")==a&&dhtmlx.confirm({ok:"是",cancel:"否",text:"你确定删除此记录吗？ ",callback:function(a){a&&$.ajax({type:"GET",url:GPC.url.delectUrl+"/"+e,success:function(){GPW.grid.refreshMainGrid()}})}}),this.getColIndexById("update")==a){var t=parent.GPW.tabbar.subListTabbar.tabs("publishInfo");parent.GPW.cache.recodeId=e,t.setActive()}})},refreshMainGrid:function(e){e||(e=GPC.url.loadUrl),this.mainGrid.clearAll(),SpinnerCtl.show(),this.mainGrid.load(e,"js")}},GPW.toolbar={mainToolbar:{},queryNames:GLOBAL.P.P_SIMPLE_QUERY_NAMES,queryValues:GLOBAL.P.P_SIMPLE_QUERY_VALUES,queryOperators:GLOBAL.P.P_SIMPLE_QUERY_OPERATOR,queryFormType:GLOBAL.P.P_SIMPLE_QUERY_FORM_TYPE,onChangeQuery:function(){this.addQueryValue()},onChangeQueryOperators:function(){var e=GPW.toolbar.mainToolbar,a=e.getInput("operator").value,t=GPW.toolbar.mainToolbar.getInput("queryName"),i=t.value;a==GPC.constant.between?this.addBetweenValue(i):this.addOtherValue(i)},addBetweenValue:function(e){this.mainToolbar.removeItem("queryValue"),this.mainToolbar.removeItem("queryBegin"),this.mainToolbar.removeItem("queryEnd"),this.mainToolbar.removeItem("text_do"),this.mainToolbar.addInput("queryBegin",3,"",100),this.mainToolbar.addText("text_do",4,"到"),this.mainToolbar.addInput("queryEnd",5,"",100);var a;if(_.map(this.queryFormType,function(t,i){return i==e?void(a=t):void 0}),"calendar"==a){new dhtmlXCalendarObject(this.mainToolbar.getInput("queryBegin")),new dhtmlXCalendarObject(this.mainToolbar.getInput("queryEnd"))}},addOtherValue:function(e){var a=GPW.toolbar.mainToolbar,t=!1;if(_.map(this.queryValues,function(i,r){r==e&&(a.removeItem("queryValue"),a.removeItem("queryBegin"),a.removeItem("text_do"),a.removeItem("queryEnd"),a.addSelectEx("queryValue",3,i,100),t=!0)}),!t){a.removeItem("queryValue"),a.removeItem("queryBegin"),a.removeItem("text_do"),a.removeItem("queryEnd");var i;_.map(this.queryFormType,function(a,t){return t==e?void(i=a):void 0}),a.addInput("queryValue",3,"",200),"calendar"==i&&new dhtmlXCalendarObject(a.getInput("queryValue"))}},addOperator:function(e){var a=GPW.toolbar.mainToolbar;_.find(this.queryOperators,function(t,i){return i==e?(a.removeItem("operator"),void a.addSelectEx("operator",2,t,70,"GPW.toolbar.onChangeQueryOperators()")):void 0})},addQueryName:function(){this.mainToolbar.addSelectEx("queryName",1,this.queryNames,100,"GPW.toolbar.onChangeQuery()")},addQueryValue:function(){var e=GPW.toolbar.mainToolbar.getInput("queryName"),a=e.value,t=this,i=t.mainToolbar;t.addOperator(a);var r=i.getInput("operator").value;r==GPC.constant.between?this.addBetweenValue(a):this.addOtherValue(a)},isCheck:function(){return GLOBAL.P.check=[],GPW.grid.mainGrid.forEachRow(function(e){1==this.cells(e,0).getValue()&&GLOBAL.P.check.push(e)}),GLOBAL.P.check.length<1?(dhtmlx.alert("请选择操作记录！"),!1):!0},sendCheck:function(e,a){this.isCheck()&&dhtmlx.confirm({ok:"是",cancel:"否",text:e,callback:function(e){e&&$.ajax({type:"GET",url:GPC.url.operationUrl+"/"+a,data:{sId:GLOBAL.P.check},success:function(){GPW.grid.refreshMainGrid()}})}})},init:function(){this.mainToolbar=GPW.layout.mainGridLayout.attachToolbar();var e=this.mainToolbar;e.setIconsPath(GLOBAL.IconsPath),e.addText("text_select",0,"选"),this.addQueryName();var a=e.getInput("queryName").value;this.addOperator(a),this.addQueryValue(),e.addButton("query",9,"查询","search.gif","search_dis.gif"),e.addSeparator("sep1",10),e.addButton("detailQuery",12,"详细查询","search.png","search_dis.png");var t=[["publish","obj","发布箱",GLOBAL.P.ico],["pending","obj","待审箱",GLOBAL.P.ico]];e.addButtonSelect("approve",15,"审批",t);var i=[["delect","obj","直接删除",GLOBAL.P.ico],["junk","obj","垃圾箱",GLOBAL.P.ico]];e.addButtonSelect("del",16,"删除",i),e.addButtonSelect("category",17,"移动分类",GLOBAL.P.categorysOpts);var r=[["cream0","obj","非精华",GLOBAL.P.ico],["cream1","obj","精华I",GLOBAL.P.ico],["cream2","obj","精华II",GLOBAL.P.ico],["cream3","obj","精华III",GLOBAL.P.ico]];e.addButtonSelect("cream",18,"精华",r);var o=[["top0","obj","非置顶",GLOBAL.P.ico],["top1","obj","置顶I",GLOBAL.P.ico],["top2","obj","置顶II",GLOBAL.P.ico],["top3","obj","置顶III",GLOBAL.P.ico]];e.addButtonSelect("top",19,"置顶",o);var n=[["commentY","obj","允许评论",GLOBAL.P.ico],["commentN","obj","不允许评论",GLOBAL.P.ico]];e.addButtonSelect("pcomment",20,"评论",n);var d=[["grade0","obj","普通状态",GLOBAL.P.ico],["grade1","obj","一等级",GLOBAL.P.ico],["grade2","obj","二等级",GLOBAL.P.ico],["grade3","obj","三等级",GLOBAL.P.ico],["grade4","obj","四等级",GLOBAL.P.ico],["grade5","obj","五等级",GLOBAL.P.ico]];e.addButtonSelect("grade",21,"等级审核",d),this.mainToolbarClick()},mainToolbarClick:function(){this.mainToolbar.attachEvent("onClick",function(e){switch(e){case GPC.constant.query:var a=GPW.toolbar.mainToolbar,t=a.getInput("queryName").value,i=a.getInput("operator").value,r=new Array;if(i==GPC.constant.between){var o=a.getInput("queryBegin").value,n=a.getInput("queryEnd").value;r[0]=GLOBAL.getBetweenQueryObjct(t,i,o,n)}else{var d=a.getInput("queryValue").value;r[0]=GLOBAL.getQueryObjct(t,i,d)}var c=JSON.stringify(r),l=GPC.url.queryUrl+"&_json="+encodeURI(c);GPW.grid.refreshMainGrid(l);break;case GPC.constant.detailQuery:GPW.window.initDetailQueryWindow();break;case"approve":GPW.toolbar.isCheck();break;case"pending":GPW.toolbar.sendCheck("你确定将这些记录发送到待审箱吗？ ",e);break;case"publish":GPW.toolbar.sendCheck("你确定将这些记录发送到发布箱吗？ ",e);break;case"del":GPW.toolbar.isCheck();break;case"delect":GPW.toolbar.sendCheck("你确定将这些记录直接删除吗？ ",e);break;case"junk":GPW.toolbar.sendCheck("你确定将这些记录发送到垃圾箱吗？ ",e);break;case"category":GPW.toolbar.isCheck();break;case"cream":GPW.toolbar.isCheck();break;case"cream0":GPW.toolbar.sendCheck("你确定将这些记录设置为非精华吗？ ",e);break;case"cream1":GPW.toolbar.sendCheck("你确定将这些记录设置为精华I吗？ ",e);break;case"cream2":GPW.toolbar.sendCheck("你确定将这些记录设置为精华II吗？ ",e);break;case"cream3":GPW.toolbar.sendCheck("你确定将这些记录设置为精华III吗？ ",e);break;case"top":GPW.toolbar.isCheck();break;case"top0":GPW.toolbar.sendCheck("你确定将这些记录设置为非置顶吗？ ",e);break;case"top1":GPW.toolbar.sendCheck("你确定将这些记录设置为置顶I吗？ ",e);break;case"top2":GPW.toolbar.sendCheck("你确定将这些记录设置为置顶II吗？ ",e);break;case"top3":GLGPW.toolbar.sendCheck("你确定将这些记录设置为置顶III吗？ ",e);break;case"pcomment":GPW.toolbar.isCheck();break;case"commentN":GPW.toolbar.sendCheck("你确定将这些记录设置为不允许评论吗？ ",e);break;case"commentY":GPW.toolbar.sendCheck("你确定将这些记录设置为允许评论吗？ ",e);break;case"grade":GPW.toolbar.isCheck();break;case"grade0":GPW.toolbar.sendCheck("你确定将这些记录设置为普通状态吗？ ",e);break;case"grade1":GPW.toolbar.sendCheck("你确定将这些记录设置为一等级吗？ ",e);break;case"grade2":GPW.toolbar.sendCheck("你确定将这些记录设置为二等级吗？ ",e);break;case"grade3":GPW.toolbar.sendCheck("你确定将这些记录设置为三等级吗？ ",e);break;case"grade4":GPW.toolbar.sendCheck("你确定将这些记录设置为四等级吗？ ",e);break;case"grade5":GPW.toolbar.sendCheck("你确定将这些记录设置为五等级吗？ ",e);break;default:if(e.indexOf("_tree")>-1){if(!GPW.toolbar.isCheck())return;dhtmlx.confirm({ok:"是",cancel:"否",text:"你确定将这些记录移动分类吗？ ",callback:function(a){a&&$.ajax({type:"GET",url:GPC.url.categoryUrl+"/"+e.replace("_tree",""),data:{sId:GLOBAL.P.check},success:function(){GPW.grid.refreshMainGrid()}})}})}}})}},GPW.window={handle:{},mainWindow:{},createWindow:function(){parent.GPW?(this.mainWindow=parent.GPW.window.initSubWindow(GLOBAL.V.MainWindowWidth,GLOBAL.V.MainWindowHeight),parent.GPW.cache.grid=GPW.grid.mainGrid):(this.initHandle(),this.handle.attachViewportTo("layoutObj"),this.mainWindow=this.handle.createWindow("w1",$("#layoutObj").width()/2-GLOBAL.V.MainWindowWidth/2,30,GLOBAL.V.MainWindowWidth,GLOBAL.V.MainWindowHeight))},initHandle:function(){return this.handle=new dhtmlXWindows,this.handle},initDetailQueryWindow:function(){this.createWindow(),this.mainWindow.setText("详细查询"),this.mainWindow.setModal(!0),this.mainWindow.attachURL(GPC.url.detailQueryUrl)}},$(function(){GPW.layout.init(),GPW.grid.init(),GPW.toolbar.init()}),dhtmlxValidation.isValidIntegerEmpty=function(e){return""==e?!0:dhtmlxValidation.isValidInteger(e)},dhtmlxValidation.isValidNumericEmpty=function(e){return""==e?!0:dhtmlxValidation.isValidNumeric(e)};