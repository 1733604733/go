$(window).resize(function(){GPW.layout.mainLayout.setSizes()});var GPC={url:{queryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/queryPage/"+GLOBAL.P.CLASSNAME,toPdfUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/topdf/"+GLOBAL.P.CLASSNAME,toExcelUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/toexcel/"+GLOBAL.P.CLASSNAME},constant:{add:"add",edit:"edit",delect:"delect",query:"query",update:"update",detailQuery:"detailQuery",between:"between"}},GPW={layout:{},grid:{},paging:{}};GPW.layout={mainLayout:{},mainGridLayout:{},queryLayout:{},init:function(){this.mainLayout=new dhtmlXLayoutObject("layoutObj","2E"),this.queryLayout=this.mainLayout.cells("a"),GLOBAL.V.QueryHeight||(GLOBAL.V.QueryHeight=150),this.queryLayout.setHeight(GLOBAL.V.QueryHeight),this.queryLayout.hideHeader(),this.mainGridLayout=this.mainLayout.cells("b"),this.mainGridLayout.hideHeader()}},GPW.grid={mainGrid:{},init:function(){this.mainGrid=GPW.layout.mainGridLayout.attachGrid(),this.mainGrid.setImagePath(GLOBAL.IconsPath),this.mainGrid.setHeader(GLOBAL.P.P_GRID_HEADER),this.mainGrid.setColumnIds(GLOBAL.P.P_GRID_COLUMNIDS),this.mainGrid.setInitWidths(GLOBAL.P.P_GRID_WIDTH),this.mainGrid.setColAlign(GLOBAL.P.P_GRID_COLALIGN),this.mainGrid.setColTypes(GLOBAL.P.P_GRID_COLTYPES),this.mainGrid.setColSorting(GLOBAL.P.P_GRID_COLSORTING),this.mainGrid.setColValidators(GLOBAL.P.P_GRID_VALIDATORS),GLOBAL.initGridCombo(this.mainGrid,GLOBAL.P.P_GRID_FORMGRIDASSEMBLE),this.mainGrid.setDateFormat("%Y-%m-%d"),this.mainGrid.setEditable(!1);var t="<div id='recinfoArea' /><div id='pagingArea' style='border:none;'/>",e=GPW.layout.mainGridLayout.attachStatusBar({height:28});e.setText(t),this.mainGrid.enablePaging(!0,200,5,"pagingArea",!0,"recInfoArea"),this.mainGrid.setPagingSkin("toolbar","dhx_skyblue"),this.mainGrid.i18n.paging=GLOBAL.paging,this.mainGrid.init(),this.mainGrid.attachEvent("onXLE",function(){SpinnerCtl.close()}),this.refreshMainGrid()},refreshMainGrid:function(t){t||(t=GPC.url.refreshGridUrl),this.mainGrid.clearAll()}},GPW.form={queryForm:{},allQueryForm:GLOBAL.P.P_TOP_FORM,queryJson:function(){var t=this.queryForm,e=0,i=new Array;return t.forEachItem(function(n){var r=t.getItemType(n);if("input"==r||"combo"==r||"calendar"==r){var a=n.lastIndexOf("_End");if(0>a){var o=n.lastIndexOf("_Begin"),u=n.substring(0,o),L=t.getInput(u+"_End");if(o>-1&&null!=L){var G=L.value,l=t.getInput(n).value;l&&G&&(i[e]=GLOBAL.getBetweenQueryObjct(u,"between",l,G),e++)}else{var d=t.getItemValue(n);_.isEmpty(d)||(i[e]=GLOBAL.getQueryObjct(n,"=",d),e++)}}}}),JSON.stringify(i)},getForm:function(t,e){return t.attachForm(e)},init:function(){this.queryForm=this.getForm(GPW.layout.queryLayout,this.allQueryForm);var t=this.queryForm,e=[{type:"button",name:"query",value:"查询"},{type:"newcolumn"},{type:"button",name:"reset",value:"重置"}];"1"==GLOBAL.V.ExportExcel&&(e=_.union(e,[{type:"newcolumn"},{type:"button",name:"excel",value:"导出Excel"}])),"1"==GLOBAL.V.ExportPdf&&(e=_.union(e,[{type:"newcolumn"},{type:"button",name:"pdf",value:"导出PDF"}]));var i={type:"block",width:800,name:"blockButton",list:e};t.addItem(null,i),t.attachEvent("onInfo",function(t,e){GLOBAL.PopupFunction(e,this.getUserData(t,"info"))}),t.attachEvent("onButtonClick",function(t){if("excel"==t){var e=GPW.form.queryJson();window.location.href=GPC.url.toExcelUrl+"?_json="+encodeURI(e)+"&_report="+GLOBAL.V.ExportReportName}if("pdf"==t){var e=GPW.form.queryJson();window.location.href=GPC.url.toPdfUrl+"?_json="+encodeURI(e)+"&_report="+GLOBAL.V.ExportReportName}if("query"==t){var e=GPW.form.queryJson(),i=GPW.grid.mainGrid;i.clearAll(),SpinnerCtl.show(),i.load(GPC.url.queryUrl+"?_json="+encodeURI(e),"js")}if("reset"==t){var n=GPW.form.queryForm;n.forEachItem(function(t){var e=n.getItemType(t);"hidden"!=e&&"block"!=e&&"button"!=e&&n.setItemValue(t,"")})}})}},$(function(){GPW.layout.init(),GPW.grid.init(),GPW.form.init()});