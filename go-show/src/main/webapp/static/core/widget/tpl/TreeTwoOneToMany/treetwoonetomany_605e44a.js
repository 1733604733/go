$(window).resize(function(){GPW.layout.tabbarLayout.setHeight(360),GPW.layout.leftMainLayout.setWidth(200),GPW.layout.mainGridLayout.setHeight(180),GPW.layout.leftLayout.setSizes(),GPW.layout.mainLayout.setSizes()});var GPC={url:{treeQueryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/queryIdToTree/"+GLOBAL.P.TREECLASS,dragOrderUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/dragTree/"+GLOBAL.P.TREECLASS,treeSave:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/treeSave/"+GLOBAL.P.TREECLASS,treeGetUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/get/"+GLOBAL.P.TREECLASS,treeDelectUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/delect/"+GLOBAL.P.TREECLASS,refreshGridUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/loadPage/"+GLOBAL.P.CLASSNAME+"?_key="+GLOBAL.P.TREEONENAME+".id",refreshTwoGridUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/loadPage/"+GLOBAL.P.CLASSNAME_TWO+"?_key="+GLOBAL.P.TREEONENAME+".id",queryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/queryPage/"+GLOBAL.P.CLASSNAME_TWO+"?_key="+GLOBAL.P.TREEONENAME+".id",saveUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/save/"+GLOBAL.P.CLASSNAME+"?_key="+GLOBAL.P.TREEONENAME+".id",saveTwoUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/save/"+GLOBAL.P.CLASSNAME_TWO+"?_key="+GLOBAL.P.TREEONENAME+".id",detailQueryUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/tpl/DetailQuery/"+GLOBAL.P.CLASSNAME_TWO+"/d?_key="+GLOBAL.P.TREEONENAME+".id",updateUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/updateAll/"+GLOBAL.P.CLASSNAME+"?format=xml&_key="+GLOBAL.P.TREEONENAME+".id",updateTwoUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/updateAll/"+GLOBAL.P.CLASSNAME_TWO+"?format=xml&_key="+GLOBAL.P.TREEONENAME+".id",delectUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/delect/"+GLOBAL.P.CLASSNAME,delectTwoUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/a/delect/"+GLOBAL.P.CLASSNAME_TWO,loadActiveTabUrl:GLOBAL.S.URL+GLOBAL.P.MODULES+"/tpl/SingleGrid"},constant:{add:"add",edit:"edit",delect:"delect",query:"query",select:"select",update:"update",detailQuery:"detailQuery",between:"between"}},GPW={layout:{},toolbar:{},tree:{},grid:{},window:{},form:{},paging:{},cache:{},tabbar:{}};GPW.cache={grid:{}},GPW.layout={mainLayout:{},mainGridLayout:{},tabbarLayout:{},treeLayout:{},twoGridLayout:{},init:function(){this.mainLayout=new dhtmlXLayoutObject("layoutObj","3L"),this.leftMainLayout=this.mainLayout.cells("a"),this.leftMainLayout.setWidth(200),this.leftMainLayout.setText("左侧"),this.leftMainLayout.hideHeader(),this.leftLayout=this.leftMainLayout.attachLayout({pattern:"2E"}),this.treeLayout=this.leftLayout.cells("a"),this.treeLayout.hideHeader(),this.mainGridLayout=this.leftLayout.cells("b"),this.mainGridLayout.setHeight(180),this.mainGridLayout.hideHeader(),this.twoGridLayout=this.mainLayout.cells("b"),this.twoGridLayout.setText("主表"),this.twoGridLayout.hideHeader(),this.tabbarLayout=this.mainLayout.cells("c"),this.tabbarLayout.setHeight(360),this.tabbarLayout.setText("从表"),this.tabbarLayout.hideHeader()},maximized:function(t){t?(this.leftMainLayout.expand(),this.twoGridLayout.expand()):(this.leftMainLayout.collapse(),this.twoGridLayout.collapse())}},GPW.tree={mainTree:{},init:function(){this.mainTree=GPW.layout.treeLayout.attachTree(),this.mainTree.setImagePath(GLOBAL.IconsPath+"dhxtree_skyblue/"),this.mainTree.enableTreeImages("false"),this.mainTree.setXMLAutoLoading(GPC.url.treeQueryUrl),this.mainTree.setDataMode("json"),this.mainTree.loadJSON(GPC.url.treeQueryUrl),GLOBAL.S.SEC_U_V&&this.dragOrder(),this.onClick()},onClick:function(){this.mainTree.attachEvent("onClick",function(t){if(!this.hasChildren(t)){var e=GPC.url.refreshTwoGridUrl+"&_value="+t;GPW.grid.twoGrid.clearAll(),GPW.grid.twoGrid.load(e,function(){var e=GPC.url.refreshGridUrl+"&_value="+t;GPW.grid.refreshMainGrid(e)},"js")}return!0})},delectTree:function(){var t=GPW.tree.mainTree,e=t.getSelectedItemId();e&&dhtmlx.confirm({title:"删除树节点",ok:"是",cancel:"否",text:"您确认删除树节点: "+t.getItemText(e),callback:function(a){a&&$.ajax({type:"GET",url:GPC.url.treeDelectUrl,data:"id="+e,success:function(){t.refreshItem()}})}})},dragOrder:function(){this.mainTree.enableDragAndDrop(!0),this.mainTree.setDragBehavior("complex"),this.mainTree.attachEvent("onDrag",function(t,e,a){var i="sid="+t+"&tid="+e;a&&(i+="&id="+a),$.ajax({type:"GET",url:GPC.url.dragOrderUrl,data:i,success:function(){var i=GPW.tree.mainTree;if(0==e)i.refreshItem();else{var r=i.getParentId(t),o=i.getParentId(e);a?r==e?i.refreshItem(e):i.refreshItem():r==o?0==r?i.refreshItem():i.refreshItem(r):r!=e?i.refreshItem():i.refreshItem(r)}}})})}},GPW.grid={mainGrid:{},gridDataProcessor:{},twoGrid:{},initTowGrid:function(){this.twoGrid=GPW.layout.twoGridLayout.attachGrid(),this.twoGrid.setImagePath(GLOBAL.IconsPath),this.twoGrid.setHeader(GLOBAL.P.TWO_P_GRID_HEADER),this.twoGrid.setColumnIds(GLOBAL.P.TWO_P_GRID_COLUMNIDS),this.twoGrid.setInitWidths(GLOBAL.P.TWO_P_GRID_WIDTH),this.twoGrid.setColAlign(GLOBAL.P.TWO_P_GRID_COLALIGN),this.twoGrid.setColTypes(GLOBAL.P.TWO_P_GRID_COLTYPES),this.twoGrid.setColSorting(GLOBAL.P.TWO_P_GRID_COLSORTING),this.twoGrid.setColValidators(GLOBAL.P.TWO_P_GRID_VALIDATORS),GLOBAL.initGridCombo(this.twoGrid,GLOBAL.P.TWO_P_GRID_FORMGRIDASSEMBLE),this.twoGrid.setDateFormat("%Y-%m-%d"),GLOBAL.S.SEC_U_V||this.mainGrid.setEditable(!1),this.twoGrid.init(),this.twoGrid.attachEvent("onValidationError",function(t,e,a,i){parent.dhtmlx.message({type:"error",expire:-1,text:"校验错误："+GPW.grid.mainGrid.getColLabel(e)+","+validText(i)+",字段值不能为["+a+"]！"})}),this.gridDataProcessor=new dataProcessor(GPC.url.updateTwoUrl),this.gridDataProcessor.setTransactionMode("REST"),this.gridDataProcessor.setUpdateMode("off"),this.gridDataProcessor.enableDataNames(!0),this.gridDataProcessor.enablePartialDataSend(!0),this.gridDataProcessor.init(this.twoGrid),this.gridDataProcessor.attachEvent("onBeforeDataSending",function(t,e,a){return _.each(a,function(t){t.data&&(t.data=null,delete t.data)}),!0}),this.gridDataProcessor.attachEvent("onAfterUpdate",function(t,e,a,i){if(i instanceof Element&&null!=i.getElementsByTagName("code").item(0)){var r=i.getElementsByTagName("code").item(0).childNodes[0].nodeValue,o=i.getElementsByTagName("message").item(0).childNodes[0].nodeValue;-1==r&&parent.dhtmlx.message({type:"error",expire:-1,text:o})}}),this.twoGrid.attachEvent("onXLE",function(){SpinnerCtl.close()})},refreshTwoGrid:function(t){if(!t){var e=GPW.tree.mainTree,a=e.getSelectedItemId();t=GPC.url.refreshTwoGridUrl+"&_value="+a}this.twoGrid.clearAll(),SpinnerCtl.show(),this.twoGrid.load(t,"js")},sendGridData:function(){this.gridDataProcessor.sendData()},delectTwoGrid:function(){var t=this.twoGrid.getSelectedRowId();return t?void dhtmlx.confirm({ok:"是",cancel:"否",text:"你确定删除此记录吗？ ",callback:function(e){e&&$.ajax({type:"GET",url:GPC.url.delectTwoUrl,data:"id="+t,success:function(){GPW.grid.refreshTwoGrid(),GPW.grid.refreshMainGrid()}})}}):void dhtmlx.alert("请选中一条记录删除！")},init:function(){this.mainGrid=GPW.layout.mainGridLayout.attachGrid(),this.mainGrid.setImagePath(GLOBAL.IconsPath),this.mainGrid.setHeader(GLOBAL.P.P_GRID_HEADER),this.mainGrid.setColumnIds(GLOBAL.P.P_GRID_COLUMNIDS),this.mainGrid.setInitWidths(GLOBAL.P.P_GRID_WIDTH),this.mainGrid.setColAlign(GLOBAL.P.P_GRID_COLALIGN),this.mainGrid.setColTypes(GLOBAL.P.P_GRID_COLTYPES),this.mainGrid.setColSorting(GLOBAL.P.P_GRID_COLSORTING),this.mainGrid.setColValidators(GLOBAL.P.P_GRID_VALIDATORS),GLOBAL.initGridCombo(this.mainGrid,GLOBAL.P.P_GRID_FORMGRIDASSEMBLE),this.mainGrid.setDateFormat("%Y-%m-%d"),this.mainGrid.init(),this.mainGrid.attachEvent("onValidationError",function(t,e,a,i){parent.dhtmlx.message({type:"error",expire:-1,text:"校验错误："+GPW.grid.mainGrid.getColLabel(e)+","+GLOBAL.validText(i)+",字段值不能为["+a+"]！"})}),this.refreshMainGrid(),this.mainGrid.attachEvent("onRowSelect",function(t){GPW.tabbar.loadActiveTab(t)})},doAfterRefresh:function(){var t=GPW.grid.mainGrid;t.selectRow(0);var e=t.getSelectedRowId();null!=e&&GPW.tabbar.loadActiveTab(e)},refreshMainGrid:function(t){if(!t){var e=GPW.tree.mainTree,a=e.getSelectedItemId();t=GPC.url.refreshGridUrl+"&_value="+a}this.mainGrid.clearAll(),this.mainGrid.load(t,this.doAfterRefresh,"js")},delectMainGrid:function(){var t=this.mainGrid.getSelectedRowId();return t?void dhtmlx.confirm({ok:"是",cancel:"否",text:"你确定删除此记录吗？ ",callback:function(e){e&&$.ajax({type:"GET",url:GPC.url.delectUrl,data:"id="+t,success:function(){GPW.grid.refreshMainGrid(),GPW.grid.refreshTwoGrid()}})}}):void dhtmlx.alert("请选中一条记录删除！")}},GPW.toolbar={mainToolbar:{},queryNames:GLOBAL.P.TWO_P_SIMPLE_QUERY_NAMES,queryValues:GLOBAL.P.TWO_P_SIMPLE_QUERY_VALUES,queryOperators:GLOBAL.P.TWO_P_SIMPLE_QUERY_OPERATOR,queryFormType:GLOBAL.P.TWO_P_SIMPLE_QUERY_FORM_TYPE,treeToolbar:{},twoToolbar:{},initTwoToolbar:function(){this.twoToolbar=GPW.layout.twoGridLayout.attachToolbar(),this.twoToolbar.setIconsPath(GLOBAL.IconsPath);var t=this.twoToolbar,e=Array();GLOBAL.S.SEC_C_V&&e.push(Array(GPC.constant.add,"obj","新增","new.gif")),GLOBAL.S.SEC_U_V&&e.push(Array(GPC.constant.edit,"obj","修改","edit.gif")),GLOBAL.S.SEC_D_V&&e.push(Array(GPC.constant.delect,"obj","删除","delect.png")),t.setIconsPath(GLOBAL.IconsPath),t.addText("text_select",0,"选"),this.addQueryName();var a=t.getInput("queryName").value;this.addOperator(a),this.addQueryValue(),t.addButton("query",9,"查询","search.gif","search_dis.gif"),t.addSeparator("sep1",10),t.addButton("detailQuery",12,"详细查询","search.png","search.png"),(GLOBAL.S.SEC_U_V||GLOBAL.S.SEC_C_V||GLOBAL.S.SEC_D_V)&&t.addButtonSelect("edit",15,"编辑",e,"edit.gif","edit_dis.gif"),GLOBAL.S.SEC_U_V&&t.addButton("update",16,"更新","cut.gif","cut_dis.gif"),t.addButton("maximized",20,"全屏","fullscreen_mode.gif","fullscreen_mode.gif"),this.twoToolbarClick()},twoToolbarClick:function(){this.twoToolbar.attachEvent("onClick",function(t){switch(t){case GPC.constant.add:GPW.window.initTwoWindow(GPC.constant.add);break;case GPC.constant.edit:GPW.window.initTwoWindow(GPC.constant.edit);break;case GPC.constant.delect:GPW.grid.delectTwoGrid();break;case GPC.constant.query:var e=GPW.toolbar.twoToolbar,a=e.getInput("queryName").value,i=e.getInput("operator").value,r=new Array;if(i==GPC.constant.between){var o=e.getInput("queryBegin").value,n=e.getInput("queryEnd").value;r[0]=GLOBAL.getBetweenQueryObjct(a,i,o,n)}else{var d=e.getInput("queryValue").value;r[0]=GLOBAL.getQueryObjct(a,i,d)}var s=JSON.stringify(r),l=GPW.tree.mainTree,u=l.getSelectedItemId(),G=GPC.url.queryUrl+"&_value="+u+"&_json="+encodeURI(s);GPW.grid.refreshTwoGrid(G);break;case GPC.constant.detailQuery:GPW.window.initDetailQueryWindow();break;case GPC.constant.update:GPW.grid.sendGridData();break;case"maximized":var c=GPW.layout,e=GPW.toolbar.twoToolbar;GLOBAL.P.MAXIMIZED?(c.tabbarLayout.expand(),c.leftMainLayout.expand(),e.setItemText("maximized","全屏"),e.setItemImage("maximized","fullscreen_mode.gif"),GLOBAL.P.MAXIMIZED=!1):(c.tabbarLayout.collapse(),c.leftMainLayout.collapse(),e.setItemText("maximized","恢复"),e.setItemImage("maximized","selection.gif"),GLOBAL.P.MAXIMIZED=!0)}})},initTreeToolbar:function(){this.treeToolbar=GPW.layout.treeLayout.attachToolbar(),this.treeToolbar.setIconsPath(GLOBAL.IconsPath);var t=Array();GLOBAL.S.SEC_C_V&&t.push(Array(GPC.constant.add,"obj","新增节点","new.gif")),GLOBAL.S.SEC_U_V&&t.push(Array(GPC.constant.edit,"obj","修改节点","edit.gif")),GLOBAL.S.SEC_D_V&&t.push(Array(GPC.constant.delect,"obj","删除节点","delect.png")),t.push(Array(GPC.constant.select,"obj","取消选择","cancel.png")),this.treeToolbar.addButtonSelect("edit",0,"编辑",t,"edit.gif","edit_dis.gif"),this.treeToolbar.addSeparator("sep1",1),this.treeToolbar.addButton("refresh",2,"刷新","reload.gif","reload.gif"),this.treeToolbarClick()},treeToolbarClick:function(){this.treeToolbar.attachEvent("onClick",function(t){switch(t){case GPC.constant.add:GPW.window.initTreeWindow(GPC.constant.add);break;case GPC.constant.edit:GPW.window.initTreeWindow(GPC.constant.edit);break;case GPC.constant.delect:GPW.tree.delectTree();break;case GPC.constant.select:GPW.tree.mainTree.clearSelection();break;case"refresh":GPW.tree.mainTree.refreshItem()}})},onChangeQuery:function(){this.addQueryValue()},onChangeQueryOperators:function(){var t=GPW.toolbar.twoToolbar,e=t.getInput("operator").value,a=GPW.toolbar.mainToolbar.getInput("queryName"),i=a.value;e==GPC.constant.between?this.addBetweenValue(i):this.addOtherValue(i)},addBetweenValue:function(t){this.twoToolbar.removeItem("queryValue"),this.twoToolbar.removeItem("queryBegin"),this.twoToolbar.removeItem("queryEnd"),this.twoToolbar.removeItem("text_do"),this.twoToolbar.addInput("queryBegin",3,"",100),this.twoToolbar.addText("text_do",4,"到"),this.twoToolbar.addInput("queryEnd",5,"",100);var e;if(_.map(this.queryFormType,function(a,i){return i==t?void(e=a):void 0}),"calendar"==e){new dhtmlXCalendarObject(this.mainToolbar.getInput("queryBegin")),new dhtmlXCalendarObject(this.mainToolbar.getInput("queryEnd"))}},addOtherValue:function(t){var e=GPW.toolbar.twoToolbar,a=!1;if(_.map(this.queryValues,function(i,r){r==t&&(e.removeItem("queryValue"),e.removeItem("queryBegin"),e.removeItem("text_do"),e.removeItem("queryEnd"),e.addSelectEx("queryValue",3,i,100),a=!0)}),!a){e.removeItem("queryValue"),e.removeItem("queryBegin"),e.removeItem("text_do"),e.removeItem("queryEnd");var i;_.map(this.queryFormType,function(e,a){return a==t?void(i=e):void 0}),e.addInput("queryValue",3,"",200),"calendar"==i&&new dhtmlXCalendarObject(e.getInput("queryValue"))}},addOperator:function(t){var e=GPW.toolbar.twoToolbar;_.find(this.queryOperators,function(a,i){return i==t?(e.removeItem("operator"),void e.addSelectEx("operator",2,a,70,"GPW.toolbar.onChangeQueryOperators()")):void 0})},addQueryName:function(){this.twoToolbar.addSelectEx("queryName",1,this.queryNames,100,"GPW.toolbar.onChangeQuery()")},addQueryValue:function(){var t=GPW.toolbar.twoToolbar.getInput("queryName"),e=t.value,a=this,i=a.twoToolbar;a.addOperator(e);var r=i.getInput("operator").value;r==GPC.constant.between?this.addBetweenValue(e):this.addOtherValue(e)},init:function(){this.mainToolbar=GPW.layout.mainGridLayout.attachToolbar();var t=this.mainToolbar,e=Array();GLOBAL.S.SEC_C_V&&e.push(Array(GPC.constant.add,"obj","新增","new.gif")),GLOBAL.S.SEC_U_V&&e.push(Array(GPC.constant.edit,"obj","修改","edit.gif")),GLOBAL.S.SEC_D_V&&e.push(Array(GPC.constant.delect,"obj","删除","delect.png")),t.setIconsPath(GLOBAL.IconsPath),(GLOBAL.S.SEC_U_V||GLOBAL.S.SEC_C_V||GLOBAL.S.SEC_D_V)&&t.addButtonSelect("edit",15,"编辑",e,"edit.gif","edit_dis.gif"),t.addButton("refresh",16,"刷新","reload.gif","reload.gif"),this.mainToolbarClick()},mainToolbarClick:function(){this.mainToolbar.attachEvent("onClick",function(t){switch(t){case GPC.constant.add:GPW.window.initMainWindow(GPC.constant.add);break;case GPC.constant.edit:GPW.window.initMainWindow(GPC.constant.edit);break;case GPC.constant.delect:GPW.grid.delectMainGrid();break;case"refresh":}})}},GPW.window={handle:{},treeWindow:{},mainWindow:{},subWindow:{},createWindow:function(){this.initHandle(),this.handle.attachViewportTo("layoutObj"),this.mainWindow=this.handle.createWindow("w1",$("#layoutObj").width()/2-350,30,700,480)},initSubWindow:function(t,e){return this.initHandle(),this.handle.attachViewportTo("layoutObj"),this.subWindow=this.handle.createWindow("w1",$("#layoutObj").width()/2-t/2,30,t,e),this.subWindow},initHandle:function(){return this.handle=new dhtmlXWindows,this.handle},initTwoWindow:function(t){if(t==GPC.constant.edit){var e=GPW.grid.twoGrid.getSelectedRowId();if(!e)return void dhtmlx.alert("请选中一条记录！")}this.createWindow(),this.mainWindow.setText(t==GPC.constant.add?"新增":"修改"),this.mainWindow.setModal(!0),GPW.form.initTwoForm(this.mainWindow,t)},initMainWindow:function(t){if(t==GPC.constant.edit){var e=GPW.grid.mainGrid.getSelectedRowId();if(!e)return void dhtmlx.alert("请选中一条记录！")}this.createWindow(),this.mainWindow.setText(t==GPC.constant.add?"新增":"修改"),this.mainWindow.setModal(!0),GPW.form.init(this.mainWindow,t)},initDetailQueryWindow:function(){GPW.cache.grid=GPW.grid.twoGrid,this.createWindow(),this.mainWindow.setText("详细查询"),this.mainWindow.setModal(!0);var t=GPW.tree.mainTree,e=t.getSelectedItemId();this.mainWindow.attachURL(GPC.url.detailQueryUrl+"&_value="+e)},initTreeWindow:function(t){this.initHandle(),this.handle.attachViewportTo("layoutObj"),this.treeWindow=this.handle.createWindow("w1",$("#layoutObj").width()/2-350,30,700,380),this.treeWindow.setText(t==GPC.constant.add?"新增树节点":"修改树节点"),this.treeWindow.setModal(!0),GPW.form.initTreeForm(this.treeWindow,t)}},GPW.form={mainForm:{},treeForm:{},twoForm:{},getTreeFormData:function(){return GLOBAL.P.TREE_P_FORM},updateTreeFromData:function(){var t=GPW.tree.mainTree.getSelectedItemId(),e=this;$.ajax({cache:!1,type:"GET",url:GPC.url.treeGetUrl,data:"id="+t,success:function(t){e.treeForm.load(t)}})},initTreeForm:function(t,e){var a=this.getTreeFormData();this.treeForm=this.getForm(t,a,"tree");GPW.tree.mainTree;e==GPC.constant.edit&&this.updateTreeFromData(),this.treeForm.attachEvent("onInfo",function(t,e){GLOBAL.PopupFunction(e,this.getUserData(t,"info"))}),this.treeForm.attachEvent("onButtonClick",function(t){"save"==t&&GPW.form.treeForm.send(GPC.url.treeSave,function(t,e){GPW.window.handle.unload(),GLOBAL.errorMessage(e),GPW.tree.mainTree.refreshItem()})})},getMainFormData:function(){return GLOBAL.P.P_FORM},getTwoFormData:function(){return GLOBAL.P.TWO_P_FORM},updateMainFromData:function(){var t=GPW.grid.mainGrid,e=t.getSelectedRowId();t.forEachCell(e,function(e,a){var i=t.getColumnId(a);GPW.form.mainForm.setItemValue(i,_.unescape(e.getValue()))}),GPW.form.mainForm.setItemValue("id",e)},updateTwoFromData:function(){var t=GPW.grid.twoGrid,e=t.getSelectedRowId();t.forEachCell(e,function(e,a){var i=t.getColumnId(a);GPW.form.twoForm.setItemValue(i,_.unescape(e.getValue()))}),GPW.form.twoForm.setItemValue("id",e)},getForm:function(t,e){return t.attachForm(e)},init:function(t,e){var a=this.getMainFormData();this.mainForm=this.getForm(t,a),e==GPC.constant.edit&&this.updateMainFromData(),this.mainForm.attachEvent("onButtonClick",function(t){if("save"==t){var e=GPW.tree.mainTree,a=e.getSelectedItemId();if(!a)return void alert("请选择树节点！");SpinnerCtl.show(),GPW.form.mainForm.send(GPC.url.saveUrl+"&_value="+a,function(t,e){SpinnerCtl.close(),GPW.window.handle.unload(),GLOBAL.errorMessage(e),GPW.grid.refreshMainGrid(),GPW.grid.refreshTwoGrid()})}}),this.mainForm.attachEvent("onInfo",function(t,e){GLOBAL.PopupFunction(e,this.getUserData(t,"info"))}),this.mainForm.attachEvent("onValidateError",function(t,e){parent.dhtmlx.message({type:"error",expire:-1,text:"校验错误："+GPW.form.mainForm.getItemLabel(t)+"字段值不能为["+e+"]！"})})},initTwoForm:function(t,e){var a=this.getTwoFormData();this.twoForm=this.getForm(t,a,"two"),e==GPC.constant.edit&&this.updateTwoFromData(),this.twoForm.attachEvent("onInfo",function(t,e){GLOBAL.PopupFunction(e,this.getUserData(t,"info"))}),this.twoForm.attachEvent("onButtonClick",function(t){if("save"==t){var e=GPW.tree.mainTree,a=e.getSelectedItemId();if(!a)return void alert("请选择树节点！");SpinnerCtl.show(),GPW.form.twoForm.send(GPC.url.saveTwoUrl+"&_value="+a,function(t,e){SpinnerCtl.close(),GPW.window.handle.unload(),GLOBAL.errorMessage(e),GPW.grid.refreshMainGrid(),GPW.grid.refreshTwoGrid()})}}),this.twoForm.attachEvent("onValidateError",function(t,e){parent.dhtmlx.message({type:"error",expire:-1,text:"校验错误："+GPW.form.twoForm.getItemLabel(t)+"字段值不能为["+e+"]！"})})}},GPW.tabbar={subListTabbar:{},subInfo:GLOBAL.P.P_SUB_INFO,getTabs:function(){for(var t=GPW.tabbar.subInfo,e=new Array(t.length),a=0;a<t.length;a++){var i={};i.id=t[a].name,i.text=t[a].alias,0==a&&(i.active=!0),e[a]=i}return e},attachURL:function(t,e){var a=GPW.tabbar.subInfo,i=_.find(a,function(e){return e.name==t?e:void 0}),r=GPC.url.loadActiveTabUrl+"/"+t+"/d?_key="+i.oneName+".id&_value="+e;this.subListTabbar.tabs(t).attachURL(r)},initSubList:function(){this.subListTabbar=GPW.layout.tabbarLayout.attachTabbar({tabs:GPW.tabbar.getTabs()}),this.subListTabbar.attachEvent("onSelect",function(t){var e=GPW.grid.mainGrid,a=e.getSelectedRowId();return GPW.tabbar.attachURL(t,a),!0})},loadActiveTab:function(t){var e=this.subListTabbar.getActiveTab();this.attachURL(e,t)}},$(function(){GPW.layout.init(),GPW.tree.init(),GPW.toolbar.initTreeToolbar(),GPW.toolbar.initTwoToolbar(),GPW.grid.init(),GPW.grid.initTowGrid(),GPW.toolbar.init(),GPW.tabbar.initSubList()}),dhtmlxValidation.isValidIntegerEmpty=function(t){return""==t?!0:dhtmlxValidation.isValidInteger(t)},dhtmlxValidation.isValidNumericEmpty=function(t){return""==t?!0:dhtmlxValidation.isValidNumeric(t)};