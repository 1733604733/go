$(window).resize(function(){GPW.layout.mainLayout.setSizes()});var GPC={url:{refreshGridUrl:GLOBAL.S.URL+"/report/a/loadPage/"+GLOBAL.P.REPORT_NAME+"?rKind="+GLOBAL.P.REPORT,queryUrl:GLOBAL.S.URL+"/report/a/queryPage/"+GLOBAL.P.REPORT_NAME+"?rKind="+GLOBAL.P.REPORT,makeReportUrl:GLOBAL.S.URL+"/report/make/"+GLOBAL.P.REPORT_NAME+"?rKind="+GLOBAL.P.REPORT,delectUrl:GLOBAL.S.URL+"/report/a/delect/"},constant:{add:"add",edit:"edit",delect:"delect",query:"query",update:"update",detailQuery:"detailQuery",between:"between"}},GPW={layout:{},toolbar:{},grid:{},window:{},form:{},paging:{}};GPW.layout={mainLayout:{},mainGridLayout:{},init:function(){this.mainLayout=new dhtmlXLayoutObject("layoutObj","1C"),this.mainGridLayout=this.mainLayout.cells("a"),this.mainGridLayout.hideHeader()}},GPW.grid={mainGrid:{},gridDataProcessor:{},init:function(){this.mainGrid=GPW.layout.mainGridLayout.attachGrid(),this.mainGrid.setImagePath(GLOBAL.IconsPath),this.mainGrid.setHeader(GLOBAL.P.P_GRID_HEADER),this.mainGrid.setColumnIds(GLOBAL.P.P_GRID_COLUMNIDS),this.mainGrid.setInitWidths(GLOBAL.P.P_GRID_WIDTH),this.mainGrid.setColAlign(GLOBAL.P.P_GRID_COLALIGN),this.mainGrid.setColTypes(GLOBAL.P.P_GRID_COLTYPES),this.mainGrid.setColSorting(GLOBAL.P.P_GRID_COLSORTING),this.mainGrid.setColValidators(GLOBAL.P.P_GRID_VALIDATORS),GLOBAL.initGridCombo(this.mainGrid,GLOBAL.P.P_GRID_FORMGRIDASSEMBLE),this.mainGrid.setDateFormat("%Y-%m-%d");var e="<div id='recinfoArea' /><div id='pagingArea' style='border:none;'/>",t=GPW.layout.mainGridLayout.attachStatusBar({height:28});t.setText(e),this.mainGrid.enablePaging(!0,20,5,"pagingArea",!0,"recInfoArea"),this.mainGrid.setPagingSkin("toolbar","dhx_skyblue"),this.mainGrid.i18n.paging=GLOBAL.paging,this.mainGrid.init();for(var a,r,i,n=this.mainGrid.getColumnsNum(),o=0;n>o;o++)"pdf"==this.mainGrid.getColumnId(o)&&(a=o),"excel"==this.mainGrid.getColumnId(o)&&(r=o),"swf"==this.mainGrid.getColumnId(o)&&(i=o);2==GLOBAL.P.REPORT?(this.mainGrid.setColumnHidden(a,!0),this.mainGrid.setColumnHidden(i,!0)):this.mainGrid.setColumnHidden(r,!0),this.refreshMainGrid()},refreshMainGrid:function(e){e||(e=GPC.url.refreshGridUrl),this.mainGrid.clearAll(),this.mainGrid.load(e,"js")},delectMainGrid:function(){var e=this.mainGrid.getSelectedRowId();return e?void dhtmlx.confirm({ok:"是",cancel:"否",text:"你确定删除此记录吗？ ",callback:function(t){t&&$.ajax({type:"GET",url:GPC.url.delectUrl+e+"?rKind="+GLOBAL.P.REPORT,success:function(){GPW.grid.refreshMainGrid()}})}}):void dhtmlx.alert("请选中一条记录删除！")}},GPW.toolbar={mainToolbar:{},queryNames:GLOBAL.P.P_SIMPLE_QUERY_NAMES,queryValues:GLOBAL.P.P_SIMPLE_QUERY_VALUES,queryOperators:GLOBAL.P.P_SIMPLE_QUERY_OPERATOR,queryFormType:GLOBAL.P.P_SIMPLE_QUERY_FORM_TYPE,onChangeQuery:function(){this.addQueryValue()},onChangeQueryOperators:function(){var e=GPW.toolbar.mainToolbar,t=e.getInput("operator").value,a=GPW.toolbar.mainToolbar.getInput("queryName"),r=a.value;t==GPC.constant.between?this.addBetweenValue(r):this.addOtherValue(r)},addBetweenValue:function(e){this.mainToolbar.removeItem("queryValue"),this.mainToolbar.removeItem("queryBegin"),this.mainToolbar.removeItem("queryEnd"),this.mainToolbar.removeItem("text_do"),this.mainToolbar.addInput("queryBegin",3,"",100),this.mainToolbar.addText("text_do",4,"到"),this.mainToolbar.addInput("queryEnd",5,"",100);var t;if(_.map(this.queryFormType,function(a,r){return r==e?void(t=a):void 0}),"calendar"==t){new dhtmlXCalendarObject(this.mainToolbar.getInput("queryBegin")),new dhtmlXCalendarObject(this.mainToolbar.getInput("queryEnd"))}},addOtherValue:function(e){var t=GPW.toolbar.mainToolbar,a=!1;if(_.map(this.queryValues,function(r,i){i==e&&(t.removeItem("queryValue"),t.removeItem("queryBegin"),t.removeItem("text_do"),t.removeItem("queryEnd"),t.addSelectEx("queryValue",3,r,100),a=!0)}),!a){t.removeItem("queryValue"),t.removeItem("queryBegin"),t.removeItem("text_do"),t.removeItem("queryEnd");var r;_.map(this.queryFormType,function(t,a){return a==e?void(r=t):void 0}),t.addInput("queryValue",3,"",200),"calendar"==r&&new dhtmlXCalendarObject(t.getInput("queryValue"))}},addOperator:function(e){var t=GPW.toolbar.mainToolbar;_.find(this.queryOperators,function(a,r){return r==e?(t.removeItem("operator"),void t.addSelectEx("operator",2,a,70,"GPW.toolbar.onChangeQueryOperators()")):void 0})},addQueryName:function(){this.mainToolbar.addSelectEx("queryName",1,this.queryNames,100,"GPW.toolbar.onChangeQuery()")},addQueryValue:function(){var e=GPW.toolbar.mainToolbar.getInput("queryName"),t=e.value,a=this,r=a.mainToolbar;a.addOperator(t);var i=r.getInput("operator").value;i==GPC.constant.between?this.addBetweenValue(t):this.addOtherValue(t)},init:function(){this.mainToolbar=GPW.layout.mainGridLayout.attachToolbar();var e=this.mainToolbar;e.setIconsPath(GLOBAL.IconsPath),e.addText("text_select",0,"选"),this.addQueryName();var t=e.getInput("queryName").value;if(this.addOperator(t),this.addQueryValue(),e.addButton("query",9,"查询","new.gif","new_dis.gif"),e.addSeparator("sep1",10),GLOBAL.S.SEC_D_V&&e.addButton(GPC.constant.delect,16,"删除","new.gif","new_dis.gif"),GLOBAL.S.SEC_U_V){if(e.addSeparator("sep2",20),e.addText("text_select1",21,"生成报表日期："),"region"==GLOBAL.P.REPORT_TYPE)e.addInput("makeReportDate",22,"",100),new dhtmlXCalendarObject(e.getInput("makeReportDate")),e.addInput("endDate",23,"",100),new dhtmlXCalendarObject(e.getInput("endDate"));else{e.addInput("makeReportDate",22,"",200);var a=new dhtmlXCalendarObject(e.getInput("makeReportDate"));"month"==GLOBAL.P.REPORT_TYPE?a.setDateFormat("%Y-%m"):"year"==GLOBAL.P.REPORT_TYPE&&a.setDateFormat("%Y")}e.addButton("make",23,"生成报表","new.gif","new_dis.gif")}this.mainToolbarClick()},mainToolbarClick:function(){this.mainToolbar.attachEvent("onClick",function(e){switch(e){case GPC.constant.delect:GPW.grid.delectMainGrid();break;case GPC.constant.query:var t=GPW.toolbar.mainToolbar,a=t.getInput("queryName").value,r=t.getInput("operator").value,i=new Array;if(r==GPC.constant.between){var n=t.getInput("queryBegin").value,o=t.getInput("queryEnd").value;i[0]=GLOBAL.getBetweenQueryObjct(a,r,n,o)}else{var d=t.getInput("queryValue").value;i[0]=GLOBAL.getQueryObjct(a,r,d)}var u=JSON.stringify(i),l=GPC.url.queryUrl+"&_json="+encodeURI(u);GPW.grid.refreshMainGrid(l);break;case"make":var l,t=GPW.toolbar.mainToolbar,m=t.getInput("makeReportDate").value;if(l="region"==GLOBAL.P.REPORT_TYPE?"beginDate="+m+"&endDate="+t.getInput("endDate").value:"beginDate="+m,""==m)return void dhtmlx.alert("请选择生成报表日期！");SpinnerCtl.show(),$.ajax({url:GPC.url.makeReportUrl,type:"post",data:l,error:function(){SpinnerCtl.close(),alert("error")},success:function(){dhtmlx.alert("报表生成成功！"),SpinnerCtl.close(),GPW.grid.refreshMainGrid()}})}})}},$(function(){GPW.layout.init(),GPW.grid.init(),GPW.toolbar.init()});